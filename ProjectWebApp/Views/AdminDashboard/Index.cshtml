@{
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
    ViewData["Title"] = "Dashboard Overview";
}

@section Styles {
    <link rel="stylesheet" href="~/css/Admin-dashboard.css" asp-append-version="true" />
}

<section class="content dashboard">

    <!-- Row 1: Stats -->
    <div class="row tiles">
        <div class="card stat blue">
            <div class="icon">🧾</div>
            <div class="text">
                <div class="label">Total Bookings</div>
                <div class="value">@ViewBag.TotalBookings</div>

            </div>
        </div>

        <div class="card stat purple">
            <div class="icon">✈️</div>
            <div class="text">
                <div class="label">Active Flights</div>
                <div class="value">@ViewBag.ActiveFlights</div>
            </div>
        </div>

        <div class="card stat green">
            <div class="icon">💰</div>
            <div class="text">
                <div class="label">Revenue (MTD)</div>
                <div class="value">
                    BHD @ViewBag.RevenueMTD.ToString("0.00")
                </div>
            </div>
        </div>

        <div class="card stat orange">
            <div class="icon">👥</div>
            <div class="text">
                <div class="label">Registered Users</div>
                <div class="value">@ViewBag.RegisteredUsers</div>

            </div>
        </div>
    </div>

    <!-- Row 2 — Recent Reviews (FULL WIDTH) -->
    <div class="row row-full">
        <div class="card">
            <div class="card-h">Recent Reviews</div>
            <div class="card-b">
                <table class="table">
                    <thead>
                        <tr>
                            <th>User</th>
                            <th>Rating</th>
                            <th>Feedback</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var r in ViewBag.RecentReviews)
                        {
                            <tr>
                                <td>
                                    <strong>@r.FullName</strong><br />
                                    <small class="text-muted">@r.Email</small>
                                </td>
                                <td>
                                    @{
                                        var stars = new string('★', r.Rating);
                                    }
                                    @stars
                                </td>
                                <td>@r.Comment</td>
                                <td>@r.Date.ToString("yyyy-MM-dd")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>



    <!-- Row 3 — Three Charts -->
    <div class="row row-3col">
        <div class="card chart">
            <div class="card-h">Revenue Trend</div>
            <div class="card-b"><canvas id="revenueChart"></canvas></div>
        </div>

        <div class="card chart">
            <div class="card-h">User Growth</div>
            <div class="card-b"><canvas id="userChart"></canvas></div>
        </div>

        <div class="card chart">
            <div class="card-h">Top Routes</div>
            <div class="card-b"><canvas id="routesChart"></canvas></div>
        </div>
    </div>


    <!-- Row 4 -->
    <div class="row row-full">
        <div class="card">
            <div class="card-h">Top Performing Airlines</div>
            <div class="card-b">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Airline</th>
                            <th>Bookings This Month</th>
                            <th>Revenue (BHD)</th>
                            <th>Avg / Booking</th>
                            <th>Revenue Share</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var a in ViewBag.TopAirlines)
                        {
                            <tr>
                                <td>@a.Airline</td>
                                <td>@a.BookingsThisMonth</td>
                                <td>BHD @a.Revenue.ToString("0.00")</td>
                                <td>
                                    BHD @(a.BookingsThisMonth == 0
                                    ? "0.00"
                                    : (a.Revenue / a.BookingsThisMonth).ToString("0.00"))
                                </td>
                                <td>
                                    @a.RevenueShare.ToString("0.0")%
                                </td>
                            </tr>
                        }
                    </tbody>

                </table>
            </div>
        </div>
    </div>

</section>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    const baseOpts = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: { x: { grid: { display: false } }, y: { grid: { color: '#f3f4f6' } } }
    };

      const revenueLabels = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewBag.RevenueLabels));
      const revenueData   = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewBag.RevenueData));
      const routeLabels = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewBag.TopRoutesLabels));
      const routeData   = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewBag.TopRoutesData));

        // Line Chart - Revenue (REAL DATA)
        new Chart(document.getElementById('revenueChart'), {
            type: 'line',
            data: {
                labels: revenueLabels,
                datasets: [{
                    label: 'Revenue',
                    data: revenueData,
                    borderColor: '#2563eb',
                    backgroundColor: 'rgba(37,99,235,0.1)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: baseOpts
        });

         // =====================
        // USER GROWTH (REAL DATA)
        // =====================
        const userGrowthLabels = @Html.Raw(
            System.Text.Json.JsonSerializer.Serialize(ViewBag.UserGrowthLabels)
        );

        const userGrowthData = @Html.Raw(
            System.Text.Json.JsonSerializer.Serialize(ViewBag.UserGrowthData)
        );

        new Chart(document.getElementById('userChart'), {
            type: 'bar',
            data: {
                labels: userGrowthLabels,
                datasets: [{
                    data: userGrowthData,
                    backgroundColor: '#7c3aed',
                    borderRadius: 6
                }]
            },
            options: baseOpts
        });

    // Doughnut - Top Routes
     new Chart(document.getElementById('routesChart'), {
        type: 'doughnut',
        data: {
            labels: routeLabels,
            datasets: [{
                data: routeData,
                backgroundColor: [
                    '#2563eb',
                    '#7c3aed',
                    '#f97316',
                    '#22c55e',
                    '#ef4444'
                ],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: '70%',
            plugins: {
                legend: {
                    position: 'bottom'
                }
            }
        }
    });

      // Booking Status - Donut
new Chart(document.getElementById('flightChart'), {
    type: 'doughnut',
    data: {
        labels: ['Confirmed', 'Pending', 'Cancelled'],
        datasets: [{
            data: [65, 25, 10],
            backgroundColor: ['#10b981', '#facc15', '#ef4444'],
            borderWidth: 0
        }]
    },
    options: {
        maintainAspectRatio: false,
        responsive: true,
        cutout: '70%',
        layout: {
            padding: { bottom: 25 } // ⬅️ adds space below the donut
        },
        plugins: {
            legend: {
                position: 'bottom',
                align: 'center',
                labels: {
                    boxWidth: 14,
                    padding: 16, // ⬅️ adds more space between donut & labels
                    font: { size: 12 }
                }
            }
        }
    }
});


</script>
