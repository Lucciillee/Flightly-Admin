@{
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
    ViewData["Title"] = "Dashboard Overview";
}

@section Styles {
    <link rel="stylesheet" href="~/css/Admin-dashboard.css" asp-append-version="true" />
}

<section class="content dashboard">

    <!-- Row 1: Stats -->
    <div class="row tiles">
        <div class="card stat blue">
            <div class="icon">🧾</div>
            <div class="text">
                <div class="label">Total Bookings</div>
                <div class="value">@ViewBag.TotalBookings</div>

            </div>
        </div>

        <div class="card stat purple">
            <div class="icon">✈️</div>
            <div class="text">
                <div class="label">Active Flights</div>
                <div class="value">@ViewBag.ActiveFlights</div>
            </div>
        </div>

        <div class="card stat green">
            <div class="icon">💰</div>
            <div class="text">
                <div class="label">Revenue (MTD)</div>
                <div class="value">
                    BHD @ViewBag.RevenueMTD.ToString("0.00")
                </div>
            </div>
        </div>

        <div class="card stat orange">
            <div class="icon">👥</div>
            <div class="text">
                <div class="label">Registered Users</div>
                <div class="value">@ViewBag.RegisteredUsers</div>

            </div>
        </div>
    </div>

    <!-- Row 2 — Recent Reviews (FULL WIDTH) -->
    <div class="row row-full">
        <div class="card">
            <div class="card-h">Recent Reviews</div>
            <div class="card-b">
                <div class="table-scroll">
                <table class="table">
                    <thead>
                        <tr>
                            <th>User</th>
                            <th>Rating</th>
                            <th>Feedback</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var r in ViewBag.RecentReviews)
                        {
                            <tr>
                                <td>
                                    <strong>@r.FullName</strong><br />
                                    <small class="text-muted">@r.Email</small>
                                </td>
                                    <td>
                                        <span class="rating-stars">
                                            @for (int i = 1; i <= 5; i++)
                                            {
                                                if (i <= r.Rating)
                                                {
                                                    <span class="star filled">★</span>
                                                }
                                                else
                                                {
                                                    <span class="star">★</span>
                                                }
                                            }
                                        </span>
                                    </td>

                                <td>@r.Comment</td>
                                <td>@r.Date.ToString("yyyy-MM-dd")</td>
                            </tr>
                        }
                    </tbody>
                </table>
                </div>
            </div>
        </div>
    </div>



    <!-- Row 3 — Three Charts -->
    <div class="row row-3col">
        <div class="card chart">
            <div class="card-h">Revenue Trend</div>
            <div class="card-b"><canvas id="revenueChart"></canvas></div>
        </div>

        <div class="card chart">
            <div class="card-h">User Growth</div>
            <div class="card-b"><canvas id="userChart"></canvas></div>
        </div>

        <div class="card chart">
            <div class="card-h">Top Routes</div>
            <div class="card-b"><canvas id="routesChart"></canvas></div>
        </div>
    </div>


    <!-- Row 4 -->
    <div class="row row-full">
        <div class="card">
            <div class="card-h">Top Performing Airlines</div>
            <div class="card-b">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Airline</th>
                            <th>Bookings This Month</th>
                            <th>Revenue (BHD)</th>
                            <th>Avg / Booking</th>
                            <th>Revenue Share</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var a in ViewBag.TopAirlines)
                        {
                            <tr>
                                <td>@a.Airline</td>
                                <td>@a.BookingsThisMonth</td>
                                <td>BHD @a.Revenue.ToString("0.00")</td>
                                <td>
                                    BHD @(a.BookingsThisMonth == 0
                                    ? "0.00"
                                    : (a.Revenue / a.BookingsThisMonth).ToString("0.00"))
                                </td>
                                <td>
                                    @a.RevenueShare.ToString("0.0")%
                                </td>
                            </tr>
                        }
                    </tbody>

                </table>
            </div>
        </div>
    </div>

</section>


<script>
    window.dashboardData = {
        revenueLabels: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewBag.RevenueLabels)),
        revenueData: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewBag.RevenueData)),

        userGrowthLabels: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewBag.UserGrowthLabels)),
        userGrowthData: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewBag.UserGrowthData)),

        routeLabels: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewBag.TopRoutesLabels)),
        routeData: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewBag.TopRoutesData))
    };
</script>

<!-- Chart.js CDN -->
@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="~/js/admin-dashboard.js" asp-append-version="true"></script>
}