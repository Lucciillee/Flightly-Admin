@model IEnumerable<ProjectWebApp.Model.UserProfile>

@{
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
    ViewData["Title"] = "Manage Users";
}

@section Styles {
    <link rel="stylesheet" href="~/css/admin-users.css" asp-append-version="true" />
}

<div class="content">
    @if (TempData["Success"] != null)
    {
        <div class="success-alert">
            @TempData["Success"]
        </div>
    }

    <!-- Users Table -->
    <div class="card">
        <div class="card-h">Users</div>
        <div class="card-b">

            <!-- Search Bar -->
            <div class="search-bar left">
                <input type="text" id="userSearch" placeholder="Search by name or email..." />
                <button class="btn primary">Search</button>
            </div>
            <div class="table-scroll">
            <table class="table" id="usersTable">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Joined</th>
                        <th class="right">Action</th>
                    </tr>
                </thead>

                <tbody>
                    @foreach (var user in Model)
                    {
                        <tr>
                            <td>@user.FirstName @user.LastName</td>
                            <td>@user.Email</td>
                            <td>@user.CreatedAt.ToString("yyyy-MM-dd")</td>

                            <td class="right">
                                <a href="/AdminUsers/Details/@user.UserId" class="btn small outline">
                                    View Details
                                </a>

                                @if (user.IsDeleted)
                                {
                                    <!-- User is blocked -->
                                    <a href="/AdminUsers/Unblock/@user.UserId" class="btn small">Unblock</a>
                                }
                                else
                                {
                                    <!-- User is active -->
                                    <a href="/AdminUsers/Block/@user.UserId" class="btn small">Block</a>
                                }
                            </td>
                        </tr>
                    }
                </tbody>

            </table>
            </div>
        </div>
    </div>

    <!-- User Growth Chart -->
    <div class="card chart">
        <div class="card-h">User Growth</div>
        <div class="card-b">
            <div class="chart-wrapper">
                <canvas id="usersChart"></canvas>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        window.usersChartData = {
            labels: @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.MonthLabels)),
            counts: @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.MonthCounts))
        };
    </script>

    <script src="~/js/admin-users-index.js" asp-append-version="true"></script>
}

