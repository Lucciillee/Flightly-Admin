@model List<ProjectWebApp.Model.FeaturedDestination>

@{
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
    ViewData["Title"] = "Manage Featured Destinations";
}

@section Styles {
    <link rel="stylesheet" href="~/css/admin-destinations.css" asp-append-version="true" />
}

<div class="content">

    <!-- ================= POPUP AD CONTROL ================= -->
    <div class="card" style="margin-top:30px;">
        <div class="card-h flex-between">
            <span>Tourism Popup Ad Control</span>
        </div>

        <div class="card-b">
            <form asp-action="UpdateTourismPopup"
                  method="post"
                  enctype="multipart/form-data"
                  class="popup-admin-grid">

                <div class="popup-admin-image">
                    <img src="@(ViewBag.TourismPopup?.ImageUrl
                            ?? "/img/Moscow-Russia-St.-Basils-Cathedral_1_0.jpg")"
                         alt="Popup Image"
                         id="popupPreview" />

                    <label class="upload-btn">
                        <input type="file"
                               name="ImageFile"
                               hidden
                               onchange="previewPopupImage(this)" />
                        Replace Image
                    </label>
                </div>

                <div class="popup-admin-fields">
                    <label>City Name</label>
                    <input class="admin-input"
                           name="CityName"
                           value="@ViewBag.TourismPopup?.PlaceName"
                           required />
                    <label>Popup Text</label>
                    <textarea required class="admin-input"
                              name="PopupText"
                              rows="3">@ViewBag.TourismPopup?.PopupText</textarea>

                    <button class="btn primary"
                            style="margin-top:10px;">
                        Update Popup
                    </button>
                </div>

            </form>
        </div>
    </div>


    <!-- ================= FEATURED DESTINATIONS CONTROL ================= -->
    <div class="card">
        <div class="card-h flex-between">
            <span>Featured Destinations</span>
            <a asp-action="Create" class="btn primary">
                + Add Destination
            </a>
        </div>

        <div class="card-b">
            <div class="featured-admin-grid">

                @foreach (var destination in Model)
                {
                    <div class="featured-admin-card">

                        <form asp-action="Update"
                              method="post"
                              enctype="multipart/form-data">

                            <input type="hidden"
                                   name="id"
                                   value="@destination.DestinationId" />

                            <div class="image-wrapper">
                                <img src="@destination.ImageUrl"
                                     alt="@destination.CityName" />
                            </div>

                            <input class="name-input"
                                   name="CityName"
                                   value="@destination.CityName"
                                   required />

                            <label class="upload-btn">
                                <input type="file"
                                       name="ImageFile"
                                       hidden />
                                Replace Image
                            </label>

                            <button type="submit" class="btn primary full">
                                Save Changes
                            </button>

                        </form>

                        <form asp-action="Delete" method="post">
                            <input type="hidden"
                                   name="id"
                                   value="@destination.DestinationId" />

                            <button type="submit" class="btn danger full">
                                Remove
                            </button>
                        </form>

                    </div>
                }

            </div>
        </div>
    </div>

    <!-- ================= DELETED DESTINATIONS ================= -->
    @if (ViewBag.DeletedDestinations != null && ViewBag.DeletedDestinations.Count > 0)
    {
        <div class="card" style="margin-top:30px;">
            <div class="card-h">
                <span>Deleted Destinations</span>
            </div>

            <div class="card-b">
                <div class="featured-admin-grid">

                    @foreach (var destination in ViewBag.DeletedDestinations)
                    {
                        <div class="featured-admin-card deleted">

                            <div class="image-wrapper">
                                <img src="@destination.ImageUrl"
                                     alt="@destination.CityName" />
                            </div>

                            <input class="name-input"
                                   value="@destination.CityName"
                                   disabled />

                            <form asp-action="Restore" method="post">
                                <input type="hidden"
                                       name="id"
                                       value="@destination.DestinationId" />

                                <button type="submit"
                                        class="btn success full">
                                    Restore
                                </button>
                            </form>

                        </div>
                    }

                </div>
            </div>
        </div>
    }

   

</div>
<script>
    function previewPopupImage(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = e => {
                document.getElementById('popupPreview').src = e.target.result;
            };
            reader.readAsDataURL(input.files[0]);
        }
    }
</script>