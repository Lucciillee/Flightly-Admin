@model ProjectWebApp.ViewModels.BookingDetailsVM

@{
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
    ViewData["Title"] = "Booking Details";
}

@section Styles {
    <link rel="stylesheet" href="~/css/admin-booking-details.css" asp-append-version="true" />
}

<div class="content">
    @if (TempData["Success"] != null)
    {
        <div id="successAlert" style="
    background:#d4f8d4;
    color:#236423;
    padding:12px 18px;
    border:1px solid #a6e6a6;
    border-radius:8px;
    margin-bottom:18px;
    font-size:15px;
    font-weight:500;">
            @TempData["Success"]
        </div>

    }

    <div style="margin-bottom: 20px;">
        <a href="/AdminBookings" class="btn" style="display:inline-flex; align-items:center; gap:6px;">
            ← Back to All Bookings
        </a>
    </div>
    <section class="grid2">

        <!-- Booking Summary -->
        <div class="card">
            <div class="card-h">Summary</div>
            <div class="card-b">

                <!-- User + Payment + Total -->
                <div class="row">
                    <div>
                        <div class="muted small">Passenger</div>
                        <div class="big">@Model.UserName</div>
                    </div>
                   
                   
                </div>

                <div class="row"
                     style="
        margin-top:10px;
        display:grid;
        grid-template-columns: 1fr 1fr;
        gap:30px;
">
                    <!-- LEFT COLUMN -->
                    <div>
                        <div class="muted small">Email</div>
                        <div>@Model.Email</div>

                        <div style="margin-top:15px;">
                            <div class="muted small">Payment</div>
                            <div>
                                <span class="badge ok">@Model.PaymentStatus</span>
                                • @Model.PaymentMethod
                            </div>
                        </div>

                        @if (Model.IsRegisteredUser)
                        {
                            <div style="margin-top:15px;">
                                <div class="muted small">Booked By (Account Email)</div>
                                <div>@Model.AccountEmail</div>
                            </div>
                        }
                    </div>

                    <!-- RIGHT COLUMN -->
                    <div>
                        <div class="muted small">Account Type</div>
                        @if (Model.IsRegisteredUser)
                        {
                            <span class="badge pink">Registered User</span>
                        }
                        else
                        {
                            <span class="badge warn">Guest Booking</span>
                        }

                        <div style="margin-top:15px;">
                            <div class="muted small">Total</div>
                            <div class="big">BHD @Model.TotalAmount.ToString("0.00")</div>
                        </div>
                    </div>
                </div>


                <hr class="line" />

                <!-- Flight + Status -->
                <div class="row">
                    <div>
                        <div class="muted small">
                            Outbound Flight
                            @if (Model.HasReturnFlight)
                            {
                                <span class="badge info" style="margin-left:8px;">Round Trip</span>
                            }
                            </div>
                        <div class="big">
                            @Model.FlightNumber • @Model.OriginCode → @Model.DestinationCode
                        </div>

                        <div class="muted">
                            Dep: @Model.DepartureTime.ToString("yyyy-MM-dd HH:mm")
                            • Arr: @Model.ArrivalTime.ToString("yyyy-MM-dd HH:mm")
                        </div>

                        <div class="muted">@Model.CabinClass</div>
                    </div>




                    <div>
                        <div class="muted small">Status</div>

                        @if (Model.Status == "Confirmed")
                        {
                            <div><span class="badge ok">Confirmed</span></div>
                        }
                        else if (Model.Status == "Cancelled")
                        {
                            <div><span class="badge bad">Cancelled</span></div>
                        }
                        else
                        {
                            <div><span class="badge warn">@Model.Status</span></div>
                        }
                    </div>
                </div>

                @if (Model.HasReturnFlight)
                {
                    <hr class="line" />

                    <div class="row">
                        <div>
                            <div class="muted small">Return Flight</div>
                            <div class="big">
                                @Model.ReturnFlightNumber • @Model.ReturnOriginCode → @Model.ReturnDestinationCode
                            </div>

                            <div class="muted">
                                Dep: @Model.ReturnDepartureTime?.ToString("yyyy-MM-dd HH:mm")
                                • Arr: @Model.ReturnArrivalTime?.ToString("yyyy-MM-dd HH:mm")
                            </div>
                        </div>
                    </div>
                }

            </div>
        </div>

        <!-- Actions -->
        <div class="card actions">
            <div class="card-h">Actions</div>
            <div class="card-b">
                <div class="col"> 
                    <a class="btn" href="/AdminBookingDetails/ResendEmail/@Model.BookingId">Resend Email</a>

                    <a class="btn" href="/AdminBookingDetails/Refund/@Model.BookingId">Refund</a>

                    @if (Model.Status == "Cancelled")
                    {
                        <button class="btn danger" disabled>
                            Booking Cancelled
                        </button>
                    }
                    else
                    {
                        <button type="button"
                                class="btn danger"
                                onclick="openCancelBookingModal(@Model.BookingId)">
                            Cancel Booking
                        </button>
                    }

                </div>

            </div>
        </div>
        <!-- ===========================
           CANCEL BOOKING MODAL
        =========================== -->
        <div id="cancelBookingModal" class="modal-overlay">
            <div class="modal-card">
                <h3>Cancel Booking</h3>
                <p>
                    Are you sure you want to cancel this booking?<br />
                    <strong>This action cannot be undone.</strong>
                </p>

                <div class="modal-actions">
                    <button class="btn" onclick="closeCancelBookingModal()">No</button>

                    <a id="confirmCancelBooking"
                       class="btn danger">
                        Yes, Cancel
                    </a>
                </div>
            </div>
        </div>

    </section>
</div>
@section Scripts {
    <script src="~/js/admin-booking-details.js" asp-append-version="true"></script>
}

