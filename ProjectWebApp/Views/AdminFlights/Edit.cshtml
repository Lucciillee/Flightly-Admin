@model ProjectWebApp.ViewModels.EditFlightVM

@{
    Layout = "~/Views/Shared/_LayoutAdmin.cshtml";
    ViewData["Title"] = "Edit Flight";

    bool isCancelled = Model.StatusId == 3;  // 4 = Cancelled in your DB
}

@section Styles {
    <link rel="stylesheet" href="~/css/admin-flights.css" asp-append-version="true" />
}

<div class="content">

    <div class="card">
        <div class="card-h">Edit Flight</div>

        <div class="card-b">

            <!-- 🔴 FORM-LEVEL VALIDATION SUMMARY -->
            <div asp-validation-summary="ModelOnly" class="validation-summary"></div>

            <!-- CANCELLED WARNING -->
            @if (isCancelled)
            {
                <div style="background:#ffe5e5; padding:12px; border-left:5px solid #d11; margin-bottom:15px;">
                    <strong style="color:#b00;">This flight has been CANCELLED and cannot be modified.</strong>
                </div>
            }

            <form asp-action="Edit" method="post" class="grid3">
                <input type="hidden" asp-for="FlightId" />

                <label class="field">
                    <span>Airline</span>
                    <input value="@Model.AirlineName" disabled />
                </label>

                <label class="field">
                    <span>Flight No.</span>
                    <input asp-for="FlightNumber" disabled="@(isCancelled ? "disabled" : null)" />
                    <span asp-validation-for="FlightNumber" class="error"></span>
                </label>

                <label class="field">
                    <span>Aircraft</span>
                    <input asp-for="Aircraft" disabled="@(isCancelled ? "disabled" : null)" />
                    <span asp-validation-for="Aircraft" class="error"></span>
                </label>

                <label class="field">
                    <span>Origin</span>
                    <input value="@Model.OriginCode" disabled />
                </label>

                <label class="field">
                    <span>Destination</span>
                    <input value="@Model.DestinationCode" disabled />
                </label>

                <label class="field">
                    <span>Departure</span>
                    <input asp-for="DepartureTime" type="datetime-local"
                           disabled="@(isCancelled ? "disabled" : null)" />
                    <span asp-validation-for="DepartureTime" class="error"></span>
                </label>

                <label class="field">
                    <span>Arrival</span>
                    <input asp-for="ArrivalTime" type="datetime-local"
                           disabled="@(isCancelled ? "disabled" : null)" />
                    <span asp-validation-for="ArrivalTime" class="error"></span>
                </label>

                <label class="field">
                    <span>Base Price</span>
                    <input asp-for="BasePrice" type="number" step="0.01"
                           disabled="@(isCancelled ? "disabled" : null)" />
                    <span asp-validation-for="BasePrice" class="error"></span>
                </label>

                <label class="field">
                    <span>Status</span>
                    <select asp-for="StatusId" asp-items="Model.Statuses"
                            disabled="@(isCancelled ? "disabled" : null)">
                    </select>
                    <span asp-validation-for="StatusId" class="error"></span>
                </label>

                <div class="actions">
                    <a href="/AdminFlights" class="btn">Cancel</a>

                    <button type="submit" class="btn primary"
                            disabled="@(isCancelled ? "disabled" : null)"
                            style="@(isCancelled ? "opacity:0.5; cursor:not-allowed;" : "")">
                        Save Changes
                    </button>
                </div>
            </form>
        </div>

    </div>

</div>
@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
